<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>VS Code Lyric Console (Final Fixed)</title>
Â  Â  <style>
Â  Â  Â  Â  /* --- VS Code Dark Theme ìŠ¤íƒ€ì¼ --- */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-color: #1e1e1e;
Â  Â  Â  Â  Â  Â  --sidebar-color: #252526;
Â  Â  Â  Â  Â  Â  --terminal-bg: #1e1e1e;
Â  Â  Â  Â  Â  Â  --text-color: #d4d4d4;
Â  Â  Â  Â  Â  Â  --keyword: #569cd6;Â 
Â  Â  Â  Â  Â  Â  --string: #ce9178;Â Â 
Â  Â  Â  Â  Â  Â  --comment: #6a9955;Â 
Â  Â  Â  Â  Â  Â  --class-name: #4ec9b0;Â 
Â  Â  Â  Â  Â  Â  --method: #dcdcaa;Â 
Â  Â  Â  Â  Â  Â  --number: #b5cea8;Â 
Â  Â  Â  Â  Â  Â  --statusbar: #007acc;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  Â  Â  font-family: 'Consolas', 'Courier New', monospace;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ë©”ì¸ ë ˆì´ì•„ì›ƒ: ì‚¬ì´ë“œë°” + ì—ë””í„° */
Â  Â  Â  Â  #workspace {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ì‚¬ì´ë“œë°” */
Â  Â  Â  Â  #sidebar {
Â  Â  Â  Â  Â  Â  width: 300px;
Â  Â  Â  Â  Â  Â  background-color: var(--sidebar-color);
Â  Â  Â  Â  Â  Â  border-right: 1px solid #333;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }
Â  Â  Â  Â  .sidebar-header {
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  color: #bbb;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }
Â  Â  Â  Â  .search-box {
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  input {
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  background-color: #3c3c3c;
Â  Â  Â  Â  Â  Â  border: 1px solid #3c3c3c;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 6px 8px;
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  font-family: inherit;
Â  Â  Â  Â  }
Â  Â  Â  Â  input:focus { border-color: var(--keyword); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #result-list {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  list-style: none;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .song-item {
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  Â  Â  Â  border-left: 3px solid transparent;
Â  Â  Â  Â  }
Â  Â  Â  Â  .song-item:hover { background-color: #2a2d2e; }
Â  Â  Â  Â  .song-item.active { background-color: #37373d; border-left-color: var(--keyword); }

Â  Â  Â  Â  /* ë©”ì¸ ì˜ì—­ */
Â  Â  Â  Â  #main-container {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ìƒë‹¨: ê°€ì§œ ì½”ë“œ ì—ë””í„° */
Â  Â  Â  Â  #editor-upper {
Â  Â  Â  Â  Â  Â  flex: 4;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-bar {
Â  Â  Â  Â  Â  Â  background-color: #2d2d2d;
Â  Â  Â  Â  Â  Â  height: 35px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);
Â  Â  Â  Â  Â  Â  padding: 0 15px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  border-top: 2px solid var(--keyword);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fake-code-area {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* í•˜ë‹¨: í„°ë¯¸ë„ (ê°€ì‚¬ ì¶œë ¥) */
Â  Â  Â  Â  #terminal-lower {
Â  Â  Â  Â  Â  Â  flex: 6;
Â  Â  Â  Â  Â  Â  background-color: var(--terminal-bg);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  border-top: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .terminal-tabs {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  background-color: #252526;
Â  Â  Â  Â  Â  Â  height: 30px;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding-left: 10px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .terminal-tab {
Â  Â  Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  Â  Â  color: #888;
Â  Â  Â  Â  Â  Â  margin-right: 20px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .terminal-tab.active { color: white; border-bottom: 1px solid white; }

Â  Â  Â  Â  #console-output {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  font-family: 'Consolas', monospace;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  white-space: pre-wrap;
Â  Â  Â  Â  Â  Â  color: #cccccc;
Â  Â  Â  Â  }
Â  Â  Â  Â  .console-line {
Â  Â  Â  Â  Â  Â  margin-bottom: 6px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  line-height: 1.4;
Â  Â  Â  Â  }
Â  Â  Â  Â  .prompt { color: var(--keyword); margin-right: 10px; font-weight: bold; user-select: none;}
Â  Â  Â  Â  .lyrics-text {Â 
Â  Â  Â  Â  Â  Â  color: #ce9178;
Â  Â  Â  Â  Â  Â  transition: color 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lyrics-text.highlight {Â 
Â  Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 5px rgba(255,255,255,0.3);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* í•˜ë‹¨ ìƒíƒœë°” */
Â  Â  Â  Â  #status-bar {
Â  Â  Â  Â  Â  Â  height: 22px;
Â  Â  Â  Â  Â  Â  background-color: var(--statusbar);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 0 10px;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ìœ í‹¸ */
Â  Â  Â  Â  .kw { color: var(--keyword); }
Â  Â  Â  Â  .str { color: var(--string); }
Â  Â  Â  Â  .cmt { color: var(--comment); }
Â  Â  Â  Â  .cls { color: var(--class-name); }
Â  Â  Â  Â  .mth { color: var(--method); }
Â  Â  Â  Â  .num { color: var(--number); }
Â  Â  Â  Â  .line-num { color: #858585; margin-right: 20px; user-select: none; text-align: right; display: inline-block; width: 30px;}

Â  Â  </style>
</head>
<body>

Â  Â  <div id="workspace">
Â  Â  Â  Â  <div id="sidebar">
Â  Â  Â  Â  Â  Â  <div class="sidebar-header">
Â  Â  Â  Â  Â  Â  Â  Â  <span>EXPLORER</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>...</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="search-box">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="searchInput" placeholder="Search (Enter)" onkeypress="handleEnter(event)">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <ul id="result-list">
Â  Â  Â  Â  Â  Â  Â  Â  <li class="song-item" style="color: gray;">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="main-container">
Â  Â  Â  Â  Â  Â  <div id="editor-upper">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="tab-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="tab">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸµ MusicPlayer.java</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="fake-code-area"></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="terminal-lower">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="terminal-tabs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="terminal-tab">PROBLEMS</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="terminal-tab">OUTPUT</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="terminal-tab active">DEBUG CONSOLE</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="terminal-tab">TERMINAL</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="console-output">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="console-line">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="prompt">player $</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Waiting for input...</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="status-bar">
Â  Â  Â  Â  <div id="status-left">Ready</div>
Â  Â  Â  Â  <div id="status-right">Java 17 â€¢ UTF-8 â€¢ ğŸš€ â€¢ <span id="player-status">Player: Initializing...</span></div>
Â  Â  </div>

Â  Â  <div style="position: fixed; bottom: 25px; right: 10px; width: 300px; height: 200px; z-index: 1000; border: 2px solid #007acc; background: #1e1e1e;">
Â  Â  Â  Â  <div id="hidden-player"></div>
Â  Â  </div>
Â  Â Â 
Â  Â  <script src="https://www.youtube.com/iframe_api"></script>

Â  Â  <script>
Â  Â  Â  Â  // --- 1. ë”ë¯¸ ì½”ë“œ (ë””ìì¸) ---
Â  Â  Â  Â  const dummyCode = [
Â  Â  Â  Â  Â  Â  `<span class="kw">package</span> com.vscode.music;`,
Â  Â  Â  Â  Â  Â  ``,
Â  Â  Â  Â  Â  Â  `<span class="kw">import</span> java.util.EmotionalEngine;`,
Â  Â  Â  Â  Â  Â  `<span class="kw">import</span> java.util.SyllableSync;`,
Â  Â  Â  Â  Â  Â  ``,
Â  Â  Â  Â  Â  Â  `<span class="kw">public class</span> <span class="cls">MusicPlayer</span> {`,
Â  Â  Â  Â  Â  Â  `Â  Â  <span class="kw">public static void</span> <span class="mth">main</span>(String[] args) {`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  <span class="cmt">// 1. í”Œë ˆì´ì–´ ì—”ì§„ ì´ˆê¸°í™”</span>`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  <span class="cls">AudioStream</span> stream = <span class="kw">new</span> <span class="cls">AudioStream</span>();`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  stream.<span class="mth">connect</span>(<span class="str">"YouTube_Server"</span>);`,
Â  Â  Â  Â  Â  Â  ``,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  <span class="cmt">// 2. ìë™ ìš°íšŒ ì ‘ì† ì‹œë„...</span>`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  <span class="kw">try</span> {`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  Â  Â  stream.<span class="mth">play</span>();`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  } <span class="kw">catch</span> (<span class="cls">CopyrightException</span> e) {`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  Â  Â  stream.<span class="mth">switchToLyricsMode</span>();`,
Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  }`,
Â  Â  Â  Â  Â  Â  `Â  Â  }`,
Â  Â  Â  Â  Â  Â  `}`
Â  Â  Â  Â  ];

Â  Â  Â  Â  function renderDummyCode() {
Â  Â  Â  Â  Â  Â  const area = document.getElementById('fake-code-area');
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â  dummyCode.forEach((line, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div><span class="line-num">${i + 1}</span>${line}</div>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  area.innerHTML = html;
Â  Â  Â  Â  }
Â  Â  Â  Â  renderDummyCode();

Â  Â  Â  Â  // --- 2. í•µì‹¬ ë¡œì§ ---
Â  Â  Â  Â  let lyricsData = [];
Â  Â  Â  Â  let player;
Â  Â  Â  Â  let syncInterval;
Â  Â  Â  Â  let lastPrintedIndex = -1;
Â  Â  Â  Â  let currentSyllableTimeouts = [];
Â  Â  Â  Â  let loadTimeout = null;Â 
Â  Â  Â  Â  let currentSongInfo = null;
Â  Â  Â  Â  let currentLineElement = null;Â 
Â  Â  Â  Â  let isRetrying = false;Â 

Â  Â  Â  Â  function handleEnter(e) { if(e.key === 'Enter') searchMusic(); }

Â  Â  Â  Â  async function searchMusic() {
Â  Â  Â  Â  Â  Â  const query = document.getElementById('searchInput').value;
Â  Â  Â  Â  Â  Â  if(!query) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const list = document.getElementById('result-list');
Â  Â  Â  Â  Â  Â  list.innerHTML = '<li class="song-item">Searching...</li>';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`https://lrclib.net/api/search?q=${encodeURIComponent(query)}`);
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  const validSongs = data.filter(song => song.syncedLyrics);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  if (validSongs.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '<li class="song-item">No synced lyrics found.</li>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  validSongs.forEach(song => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.className = 'song-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.innerHTML = `<span>ğŸµ ${song.artistName} - ${song.trackName}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.song-item').forEach(el => el.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadSong(song);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(li);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  Â  Â  list.innerHTML = '<li class="song-item" style="color:#f44747;">Error fetching data</li>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function loadSong(song) {
Â  Â  Â  Â  Â  Â  currentSongInfo = song;Â 
Â  Â  Â  Â  Â  Â  lyricsData = parseLrc(song.syncedLyrics);
Â  Â  Â  Â  Â  Â  lastPrintedIndex = -1;Â 
Â  Â  Â  Â  Â  Â  isRetrying = false;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  clearAllSyllableTimeouts();
Â  Â  Â  Â  Â  Â  if(loadTimeout) clearTimeout(loadTimeout);

Â  Â  Â  Â  Â  Â  const consoleOut = document.getElementById('console-output');
Â  Â  Â  Â  Â  Â  consoleOut.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  printToConsole(`> Loading: ${song.trackName}...`);
Â  Â  Â  Â  Â  Â  updateStatus(`Loading ${song.trackName}...`);

Â  Â  Â  Â  Â  Â  tryPlayMusic(song, false);
Â  Â  Â  Â  }

Â  Â  Â  Â  function tryPlayMusic(song, useLyricsMode) {
Â  Â  Â  Â  Â  Â  if (!playerReady) {
Â  Â  Â  Â  Â  Â  Â  Â  printToConsole("> Waiting for YouTube Player...");
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => tryPlayMusic(song, useLyricsMode), 1000);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let searchKeyword = useLyricsMode ? 'lyrics' : 'audio';
Â  Â  Â  Â  Â  Â  const searchQ = `${song.artistName} ${song.trackName} ${searchKeyword}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  printToConsole(`> Searching: ${searchQ}...`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(player && player.loadPlaylist) {
Â  Â  Â  Â  Â  Â  Â  Â  player.loadPlaylist({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listType: 'search',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list: searchQ,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  index: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startSeconds: 0
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  player.setVolume(100);

Â  Â  Â  Â  Â  Â  Â  Â  if(loadTimeout) clearTimeout(loadTimeout);
Â  Â  Â  Â  Â  Â  Â  Â  loadTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(player.getPlayerState() !== 1 && player.getPlayerState() !== 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â printManualPlayButton();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, 4000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function printManualPlayButton() {
Â  Â  Â  Â  Â  Â  if(document.getElementById('manual-play-btn')) return;

Â  Â  Â  Â  Â  Â  const consoleOut = document.getElementById('console-output');
Â  Â  Â  Â  Â  Â  const lineDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  lineDiv.id = 'manual-play-btn';
Â  Â  Â  Â  Â  Â  lineDiv.className = 'console-line';
Â  Â  Â  Â  Â  Â  lineDiv.style.cursor = 'pointer';
Â  Â  Â  Â  Â  Â  lineDiv.style.color = '#4ec9b0';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  lineDiv.innerHTML = `<span class="prompt">!</span> <span style="text-decoration:underline;">[ Click to Play (ì¬ìƒ ê¶Œí•œ ìš”ì²­) ]</span>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  lineDiv.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(player && currentSongInfo) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  printToConsole("> Retrying playback...");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lineDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tryPlayMusic(currentSongInfo, isRetrying);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  consoleOut.appendChild(lineDiv);
Â  Â  Â  Â  Â  Â  consoleOut.scrollTop = consoleOut.scrollHeight;
Â  Â  Â  Â  }

Â  Â  Â  Â  function parseLrc(lrc) {
Â  Â  Â  Â  Â  Â  const lines = [];
Â  Â  Â  Â  Â  Â  const regex = /\[(\d+):(\d+\.\d+)\](.*)/;
Â  Â  Â  Â  Â  Â  lrc.split('\n').forEach(line => {
Â  Â  Â  Â  Â  Â  Â  Â  const match = line.match(regex);
Â  Â  Â  Â  Â  Â  Â  Â  if (match) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const text = match[3].trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (text) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lines.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time: parseInt(match[1]) * 60 + parseFloat(match[2]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: text
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return lines;
Â  Â  Â  Â  }

Â  Â  Â  Â  function splitIntoSyllables(text) {
Â  Â  Â  Â  Â  Â  const syllables = [];
Â  Â  Â  Â  Â  Â  let currentSyllable = '';
Â  Â  Â  Â  Â  Â  for (let char of text) {
Â  Â  Â  Â  Â  Â  Â  Â  if (/[\u3131-\uD79D]/.test(char) || /[a-zA-Z0-9]/.test(char)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentSyllable) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  syllables.push(currentSyllable);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSyllable = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  syllables.push(char);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSyllable += char;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (syllables.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  syllables[syllables.length - 1] += char;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSyllable = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (currentSyllable) syllables.push(currentSyllable);
Â  Â  Â  Â  Â  Â  return syllables.filter(s => s.trim());
Â  Â  Â  Â  }

Â  Â  Â  Â  function printToConsole(text, isLyric = false) {
Â  Â  Â  Â  Â  Â  const consoleOut = document.getElementById('console-output');
Â  Â  Â  Â  Â  Â  const lineDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  lineDiv.className = 'console-line';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const promptSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  promptSpan.className = 'prompt';
Â  Â  Â  Â  Â  Â  promptSpan.textContent = '>';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const textSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  textSpan.className = isLyric ? 'lyrics-text' : '';
Â  Â  Â  Â  Â  Â  textSpan.textContent = isLyric ? '' : text;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  lineDiv.appendChild(promptSpan);
Â  Â  Â  Â  Â  Â  lineDiv.appendChild(textSpan);
Â  Â  Â  Â  Â  Â  consoleOut.appendChild(lineDiv);
Â  Â  Â  Â  Â  Â  consoleOut.scrollTop = consoleOut.scrollHeight;

Â  Â  Â  Â  Â  Â  if (isLyric) currentLineElement = textSpan;
Â  Â  Â  Â  }

Â  Â  Â  Â  function clearAllSyllableTimeouts() {
Â  Â  Â  Â  Â  Â  currentSyllableTimeouts.forEach(timeout => clearTimeout(timeout));
Â  Â  Â  Â  Â  Â  currentSyllableTimeouts = [];
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 4. ìœ íŠœë¸Œ API & ì—ëŸ¬ í•¸ë“¤ë§ ---
Â  Â  Â  Â  let playerReady = false;
Â  Â  Â  Â Â 
Â  Â  Â  Â  function onYouTubeIframeAPIReady() {
Â  Â  Â  Â  Â  Â  player = new YT.Player('hidden-player', {
Â  Â  Â  Â  Â  Â  Â  Â  height: '200',Â 
Â  Â  Â  Â  Â  Â  Â  Â  width: '300',
Â  Â  Â  Â  Â  Â  Â  Â  videoId: 'M7lc1UVf-VE',Â 
Â  Â  Â  Â  Â  Â  Â  Â  playerVars: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'autoplay': 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'controls': 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'origin': window.location.origin,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'enablejsapi': 1
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  events: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'onReady': onPlayerReady,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'onStateChange': onPlayerStateChange,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'onError': onPlayerError
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function onPlayerReady(event) {
Â  Â  Â  Â  Â  Â  playerReady = true;
Â  Â  Â  Â  Â  Â  document.getElementById('player-status').textContent = 'Player: Ready âœ“';
Â  Â  Â  Â  Â  Â  printToConsole("> System Ready.");
Â  Â  Â  Â  }

Â  Â  Â  Â  function onPlayerError(event) {
Â  Â  Â  Â  Â  Â  if (!currentSongInfo) return;

Â  Â  Â  Â  Â  Â  // 150(101) ì—ëŸ¬: ì €ì‘ê¶Œ ë§‰í˜ -> Lyrics ë²„ì „ìœ¼ë¡œ ìë™ ìš°íšŒ
Â  Â  Â  Â  Â  Â  if (event.data === 150 || event.data === 101) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!isRetrying) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  printToConsole("! Embedding blocked. Trying Lyrics version...");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isRetrying = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tryPlayMusic(currentSongInfo, true);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  printToConsole("ERROR: Even the lyrics version is blocked. Sorry.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  else if(event.data === 2) {
Â  Â  Â  Â  Â  Â  Â  Â  printToConsole("! Connection unstable. Retrying...");
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => tryPlayMusic(currentSongInfo, isRetrying), 2000);
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  printToConsole("YouTube Error Code: " + event.data);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function onPlayerStateChange(event) {
Â  Â  Â  Â  Â  Â  if (event.data == YT.PlayerState.PLAYING) {
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus("Running...");
Â  Â  Â  Â  Â  Â  Â  Â  if(loadTimeout) clearTimeout(loadTimeout);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('manual-play-btn');
Â  Â  Â  Â  Â  Â  Â  Â  if(btn) btn.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  if(syncInterval) clearInterval(syncInterval);
Â  Â  Â  Â  Â  Â  Â  Â  syncInterval = setInterval(checkSync, 50);
Â  Â  Â  Â  Â  Â  } else if (event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) {
Â  Â  Â  Â  Â  Â  Â  Â  if(event.data == YT.PlayerState.PAUSED) updateStatus("Paused");
Â  Â  Â  Â  Â  Â  Â  Â  if(event.data == YT.PlayerState.ENDED) updateStatus("Ended");
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(syncInterval);
Â  Â  Â  Â  Â  Â  Â  Â  clearAllSyllableTimeouts();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkSync() {
Â  Â  Â  Â  Â  Â  if(!player || !player.getCurrentTime || lyricsData.length === 0) return;
Â  Â  Â  Â  Â  Â  const currentTime = player.getCurrentTime();
Â  Â  Â  Â  Â  Â  let activeIndex = -1;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for(let i = 0; i < lyricsData.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  if (currentTime >= lyricsData[i].time) activeIndex = i;
Â  Â  Â  Â  Â  Â  Â  Â  else break;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if(activeIndex !== -1 && activeIndex !== lastPrintedIndex) {
Â  Â  Â  Â  Â  Â  Â  Â  clearAllSyllableTimeouts();
Â  Â  Â  Â  Â  Â  Â  Â  displayLyricWithSyllables(activeIndex);
Â  Â  Â  Â  Â  Â  Â  Â  lastPrintedIndex = activeIndex;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function displayLyricWithSyllables(index) {
Â  Â  Â  Â  Â  Â  const lyric = lyricsData[index];
Â  Â  Â  Â  Â  Â  const syllables = splitIntoSyllables(lyric.text);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let timeToNext;
Â  Â  Â  Â  Â  Â  if (index + 1 < lyricsData.length) timeToNext = lyricsData[index + 1].time - lyric.time;
Â  Â  Â  Â  Â  Â  else timeToNext = syllables.length * 0.3;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let timePerSyllable = Math.max(0.05, Math.min(0.5, timeToNext / syllables.length));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  printToConsole('', true);
Â  Â  Â  Â  Â  Â  syllables.forEach((syllable, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const timeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentLineElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentLineElement.textContent += syllable;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const consoleOut = document.getElementById('console-output');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  consoleOut.scrollTop = consoleOut.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, i * timePerSyllable * 1000);
Â  Â  Â  Â  Â  Â  Â  Â  currentSyllableTimeouts.push(timeout);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateStatus(msg) {
Â  Â  Â  Â  Â  Â  document.getElementById('status-left').innerText = msg;
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>

ì´ê²Œ ë‚´ê°€ ì°¾ë˜ ë””ìì¸ì´ì•¼
